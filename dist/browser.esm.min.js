var log=(e,...t)=>{e&&console.log(..."string"==typeof t[0]?[`[apitap] ${t[0]}`,...t.slice(1)]:t)};const PROXY_TARGET=Symbol("Proxy target marker"),CATCH_ALL=Symbol("Catch-all marker");function isWrappable(e){return("object"==typeof e||"function"==typeof e)&&null!==e}function getInjectedProperty(e,t,r){const n=Object.getOwnPropertyDescriptor(r,t);return n&&"function"==typeof n.get?Reflect.apply(n.get,e,[]):Reflect.get(r,t)}function wrapApi(e,t,r,n){if(!isWrappable(e)||Reflect.has(e,PROXY_TARGET))return e;return log(n,"wrap %o",e),new Proxy(e,{has:(e,t)=>t===PROXY_TARGET||Reflect.has(e,t),construct:(e,r)=>(log(n,"construct %o with %o",e,r),wrapApi(Reflect.construct(e,r),t,null,n)),get(e,r){if(r===PROXY_TARGET)return e;log(n,"get %o from %o",r,e);const o=("function"==typeof t?t(e):t)||Object.create(null);if(o instanceof Object?o.hasOwnProperty(r):r in o){log(n,"property %o shadowed by injected %o",r,o);const p=getInjectedProperty(e,r,o);return wrapApi(p,t,"function"==typeof p?e:null,n)}if(Reflect.has(e,r))return wrapApi(Reflect.get(e,r),t,null,n);if(o instanceof Object&&Reflect.has(o,CATCH_ALL)){return log(n,"property %o caught by CATCH_ALL",r),wrapApi(Reflect.apply(Reflect.get(o,CATCH_ALL),e,[r]),t,e,n)}},apply:(e,r,o)=>(log(n,"call %o with %o as %o",e,o,unwrap(r)),wrapApi(Reflect.apply(e,unwrap(r),o),t,null,n))})}function wrap(e,t=Object.create(null),r=!1){return wrapApi(e,t,null,r)}function unwrap(e){return isWrapped(e)?e[PROXY_TARGET]:e}function isWrapped(e){return isWrappable(e)&&PROXY_TARGET in e}export{CATCH_ALL,wrap,unwrap,isWrapped};
